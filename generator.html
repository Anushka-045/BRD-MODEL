<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BRD Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif;}
body{background:#0f172a;color:white;overflow-x:hidden;}
.container{display:flex;min-height:100vh;}
.sidebar{width:240px;background:#1e293b;padding:25px 15px;flex-shrink:0;display:flex;flex-direction:column;transition:0.3s;}
.sidebar.hidden{width:0;padding:0;overflow:hidden;}
.sidebar h2{text-align:center;margin-bottom:30px;font-size:20px;}
.sidebar a{display:block;color:white;text-decoration:none;padding:10px 15px;margin:6px 0;border-radius:8px;transition:0.2s;}
.sidebar a:hover{background:rgba(255,255,255,0.1);}
.menu-btn{position:fixed;top:20px;left:20px;background:#6366f1;border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer;z-index:1100;}
.content{flex:1;padding:40px 30px;}
.hero{background:rgba(255,255,255,0.08);backdrop-filter:blur(20px);padding:30px;border-radius:20px;margin-bottom:25px;}
.hero h1{font-size:36px;background:linear-gradient(90deg,#6366f1,#22d3ee);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:15px;}
.hero p{opacity:0.8;}
.card{background:rgba(255,255,255,0.05);padding:25px;border-radius:15px;margin-bottom:25px;}
.card h3{margin-bottom:12px;color:#22d3ee;}
textarea{width:100%;height:160px;border:none;border-radius:10px;padding:12px;background:rgba(255,255,255,0.1);color:white;resize:none;margin-bottom:12px;}
textarea:focus{background:rgba(255,255,255,0.15);outline:none;}
input[type="file"]{margin-top:10px;margin-bottom:12px;color:white;}
button{padding:10px 22px;border:none;border-radius:20px;background:#6366f1;color:white;cursor:pointer;}
button:hover{background:#4f46e5;}
#loading{display:none;margin-top:10px;color:#22d3ee;}
#output{margin-top:12px;white-space:pre-wrap;background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;max-height:450px;overflow:auto;font-family:monospace;font-size:14px;}
</style>
</head>

<body>

<button class="menu-btn" onclick="toggleSidebar()">â˜°</button>

<div class="container">
  <div class="sidebar" id="sidebar">
    <h2>MENU</h2>
    <a href="#">Dashboard</a>
    <a href="#">BRD Generator</a>
    <a href="#">Integrations</a>
    <a href="#">Analytics</a>
    <a href="#">Traceability</a>
    <a href="#">Settings</a>
  </div>

  <div class="content">

    <div class="hero">
      <h1 id="typewriter"></h1>
      <p>Upload communications or paste data to generate structured BRDs using AI.</p>
    </div>

    <div class="card">
      <h3>Paste Communication</h3>
      <textarea id="textInput" placeholder="Paste emails, meeting notes, chats..."></textarea>
      <button onclick="generateText()">Generate BRD</button>
    </div>

    <div class="card">
      <h3>Upload File (PDF, DOCX, Image, TXT)</h3>
      <input type="file" id="fileInput">
      <button onclick="uploadFile()">Upload & Generate</button>
    </div>

    <div id="loading">Processing... Please wait...</div>

    <div class="card">
      <h3>Generated BRD Output</h3>
      <div id="output">Result will appear here...</div>
    </div>

  </div>
</div>
<script>

const API_BASE = "http://127.0.0.1:5000";
const loading = document.getElementById("loading");
const output = document.getElementById("output");

// Sidebar
function toggleSidebar(){
  document.getElementById("sidebar").classList.toggle("hidden");
}

// Typewriter
let text="AI-Powered BRD Generator";
let i=0;
function typeWriter(){
  if(i<text.length){
    document.getElementById("typewriter").innerHTML+=text.charAt(i);
    i++;
    setTimeout(typeWriter,40);
  }
}
typeWriter();

// Format BRD nicely
function formatBRD(data){

  if(!data || typeof data !== "object"){
    return "âŒ Invalid response format from backend.";
  }

  if(data.error){
    return "âŒ ERROR:\n\n" + data.error;
  }

  return `
ðŸ“Œ EXECUTIVE SUMMARY
${data.executive_summary || "N/A"}

ðŸŽ¯ BUSINESS OBJECTIVES
${(data.business_objectives || []).map(x => "- " + x).join("\n") || "N/A"}

ðŸ‘¥ STAKEHOLDERS
${(data.stakeholders || []).map(x => "- " + x).join("\n") || "N/A"}

âš™ FUNCTIONAL REQUIREMENTS
${(data.functional_requirements || []).map(x => "- " + x).join("\n") || "N/A"}

ðŸ”’ NON-FUNCTIONAL REQUIREMENTS
${(data.non_functional_requirements || []).map(x => "- " + x).join("\n") || "N/A"}

ðŸ“ ASSUMPTIONS
${(data.assumptions || []).map(x => "- " + x).join("\n") || "N/A"}

ðŸ“… TIMELINE
${data.timeline || "N/A"}

âš  CONFLICTS
${(data.conflicts || []).map(x => "- " + x).join("\n") || "N/A"}
`;
}

// Helper function to safely call backend
async function callBackend(url, options){

  try{
    const response = await fetch(url, options);

    const text = await response.text();

    if(!response.ok){
      return { error: "Backend returned " + response.status + "\n\n" + text };
    }

    try{
      return JSON.parse(text);
    }catch(e){
      return { error: "Backend did not return valid JSON.\n\n" + text };
    }

  }catch(error){
    return { error: "Cannot connect to backend.\n\nIs Flask running on port 5000?" };
  }
}

// Generate Text
async function generateText(){

  const textInput = document.getElementById("textInput").value;

  if(!textInput.trim()){
    alert("Please enter some text");
    return;
  }

  loading.style.display="block";
  output.innerText="";

  const data = await callBackend(API_BASE + "/generate",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({text:textInput})
  });

  output.innerText = formatBRD(data);
  loading.style.display="none";
}

// Upload File
async function uploadFile(){

  const file = document.getElementById("fileInput").files[0];

  if(!file){
    alert("Please select a file");
    return;
  }

  const formData = new FormData();
  formData.append("file",file);

  loading.style.display="block";
  output.innerText="";

  const data = await callBackend(API_BASE + "/upload-file",{
    method:"POST",
    body:formData
  });

  output.innerText = formatBRD(data);
  loading.style.display="none";
}

</script>

</body>
</html>